<style>
  html, body {
    height: 100%;
    margin: 0;
    padding: 0;
  }
  #map {
    height: 83%;
  }
  .controls {
    background-color: #fff;
    border-radius: 2px;
    border: 1px solid transparent;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
    box-sizing: border-box;
    font-family: Roboto;
    font-size: 15px;
    font-weight: 300;
    height: 29px;
    margin-left: 17px;
    margin-top: 10px;
    outline: none;
    padding: 0 11px 0 13px;
    text-overflow: ellipsis;
    width: 400px;
  }

  .controls:focus {
    border-color: #4d90fe;
  }
</style>
    <!-- <div id="map"></div> -->

    <script>
      // This sample uses the Place Autocomplete widget to allow the user to search
      // for and select a place. The sample then displays an info window containing
      // the place ID and other information about the place that the user has
      // selected.

      // This example requires the Places library. Include the libraries=places
      // parameter when you first load the API. For example:
      // <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places">

      function initMap() {
        var input = document.getElementById('search-input');

        var map = new google.maps.Map(document.getElementById('map'), {
          center: {lat:   -40.900557, lng: 174.885971},
          zoom: 6


          
        });

      $(document).ready(function(){







 $.ajax({
              type: "GET",
              url: "near_homes/?locat="+input,
              success: function(data){
                console.log("Worked");
                data = JSON.parse(JSON.stringify(data));
                console.log(data);
                for(i=0 ; i<data.length;i++){
                  console.log(data[i]);
                  position = new google.maps.LatLng(data[i].lat,data[i].long);
                  //img_sel = new google.maps.MarkerImage('images/p.png');
                  marker1 = new google.maps.Marker({
                    position: position,
                    map: map

                  });
                  infowindow = new google.maps.InfoWindow();
/*                  google.maps.event.addListener(marker1, 'click', (function(marker1, i) {
                    return function() {
                        var markerid = marker1.alt;
                        var res1 = markerid.split(",");
                        var cs = 'Home';
                        infowindow.setContent(cs);
                        infowindow.open(map, marker1);
                    }
                  })(marker1, i)); */

                }
                

              }
            });


















        //lun
        $("#search-input").blur(function(){
            input = $("#search-input").val();
            $.ajax({
              type: "GET",
              url: "near_homes/?locat="+input,
              success: function(data){
                console.log("Worked");
                data = JSON.parse(JSON.stringify(data));
                console.log(data);
                for(i=0 ; i<data.length;i++){
                  console.log(data[i]);
                  position = new google.maps.LatLng(data[i].lat,data[i].long);
                  //img_sel = new google.maps.MarkerImage('images/p.png');
                  marker1 = new google.maps.Marker({
                    position: position,
                    map: map

                  });
                  infowindow = new google.maps.InfoWindow();
/*                  google.maps.event.addListener(marker1, 'click', (function(marker1, i) {
                    return function() {
                        var markerid = marker1.alt;
                        var res1 = markerid.split(",");
                        var cs = 'Home';
                        infowindow.setContent(cs);
                        infowindow.open(map, marker1);
                    }
                  })(marker1, i)); */

                }
                

              }
            });
        });
      });

        /*if(input != ""){
            var map = new google.maps.Map(document.getElementById('map'), {
              center: {lat:   -40.900557, lng: 174.885971},
              zoom: 6
            });
        }*/

//current location        
/*var infoWindow = new google.maps.InfoWindow({map: map});

        // Try HTML5 geolocation.
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            var pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };

            infoWindow.setPosition(pos);
            infoWindow.setContent('Location found.');
            map.setCenter(pos);
          }, function() {
            handleLocationError(true, infoWindow, map.getCenter());
          });
        } else {
          // Browser doesn't support Geolocation
          handleLocationError(false, infoWindow, map.getCenter());
        }*/
      

      function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                              'Error: The Geolocation service failed.' :
                              'Error: Your browser doesn\'t support geolocation.');
      }
        

        var autocomplete = new google.maps.places.Autocomplete(input);
        autocomplete.bindTo('bounds', map);

        //map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

        var infowindow = new google.maps.InfoWindow();
        var marker = new google.maps.Marker({
          map: map
        });
        marker.addListener('click', function() {
          infowindow.open(map, marker);
        });

        autocomplete.addListener('place_changed', function() {
          infowindow.close();
          var place = autocomplete.getPlace();
          if (!place.geometry) {
            return;
          }

          if (place.geometry.viewport) {
            map.fitBounds(place.geometry.viewport);
          } else {
            map.setCenter(place.geometry.location);
            map.setZoom(17);
          }

          // Set the position of the marker using the place ID and location.
     /*     marker.setPlace({
            placeId: place.place_id,
            location: place.geometry.location
          });
          marker.setVisible(true);
          console.log(place.geometry);
          infowindow.setContent('<div><strong>' + place.name + '</strong><br>' +
              'Place ID: ' + place.place_id + '<br>' + 
              JSON.parse(JSON.stringify(place)));
          infowindow.open(map, marker);*/
        });


      /*set_marker();
      function set_marker(){
          alert("dfs");
          for(var i = 1; i < <%= @homes.size %> ; i++)
          {
            var res = <%=(@homes.to_json)%>;  
            console.log(res);
              var position = new google.maps.LatLng(res.lat ,  res.long );
              
                    marker1 = new google.maps.Marker({
                      map: map,
                      position: position,
                title:'Account Name: ' +  res.name 
                });   
              infowindow = new google.maps.InfoWindow({
                content:   res.description 
                });
              
                  google.maps.event.addListener(marker1, 'click', (function(marker1, i) {
                    return function() {
                      var markerid = marker1.alt;
                  var res1 = markerid.split("|");
                      var cs =    "asd"              
                  infowindow.setContent(cs);
                  //infowindow.setContent(cs);
                  
                      infowindow.open(map, marker1);
                  }
                })(marker1, i));   
              

            markers.push(marker1);
          }
          var mc = new MarkerClusterer(map,markers);
            }*/
          


      }

      
    /*$(document).ready(function(){
      $("#search-input").blur(function(){
          input = $("#search-input").val();
          alert(input);
          $.ajax({
            type: "GET",
            url: "near_homes/?locat="+input,
            success: function(data){
              data = JSON.parse(JSON.stringify(data));
              for(i=0 ; i<data.length;i++){
                console.log(data[i]);
                position = new google.maps.LatLng(30.75,71.25);
                img_sel = new google.maps.MarkerImage('images/p.png');
                marker1 = new google.maps.Marker({
                  position: position,
                  map: map

                });
                infowindow = new google.maps.InfoWindow();
              }
              

            }
          });
      });
    });*/

    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBoUyblkGqwp2lFuWQb0v_-J_mI5sYJYPc&libraries=places&callback=initMap"
        async defer></script>